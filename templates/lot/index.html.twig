{% extends 'base.html.twig' %}

{% block title %}Catalogue des lots — Vestige d’Or{% endblock %}

{% block body %}
    <div class="mb-8 flex flex-col md:flex-row md:items-center md:justify-between">
        <div>
            <h1 class="text-3xl font-['Playfair Display'] font-semibold tracking-wide text-stone-900 inline-block">
                Notre catalogue d'antiquités
                <span class="block mt-2 h-[2px] w-16 bg-amber-600/70"></span>
            </h1>
            <p class="text-neutral-600 mt-2">Découvrez nos pièces d'exception en vente aux enchères</p>
        </div>
        <div class="mt-4 md:mt-0">
            <div class="relative">
                <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                    <svg class="h-5 w-5 text-neutral-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                    </svg>
                </span>
                <form action="{{ path('app_lot_index') }}" method="get" class="flex">
                    <input type="search" 
                           name="q" 
                           value="{{ app.request.query.get('q') }}"
                           placeholder="Rechercher un lot..."
                           class="pl-10 pr-4 py-2 border border-neutral-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-amber-500/30">
                    <button type="submit" 
                            class="px-4 py-2 bg-black text-white rounded-r-lg hover:bg-neutral-900 focus:outline-none focus:ring-2 focus:ring-amber-500/30">
                        Rechercher
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
        {# Filtres #}
        <aside class="lg:col-span-1">
            <div class="bg-white rounded-xl border border-neutral-200 p-6 space-y-6">
                <h2 class="text-lg font-semibold text-stone-900 inline-block">
                  Filtrer par
                  <span class="block mt-1 h-[2px] w-10 bg-amber-600/60"></span>
                </h2>
                
                {# Catégories #}
                <div>
                    <h3 class="text-sm font-medium text-stone-900 mb-3">Catégories</h3>
                    <div class="space-y-2">
                        {% for categorie in categories|default(['Mobilier', 'Objets d\'art', 'Luminaire', 'Décoration', 'Tableaux'])%}
                            <div class="flex items-center">
                                <input id="categorie-{{ loop.index }}" 
                                       name="categorie[]" 
                                       type="checkbox" 
                                       value="{{ categorie }}"
                                       class="h-4 w-4 rounded border-neutral-300 text-amber-600 focus:ring-amber-500/40">
                                <label for="categorie-{{ loop.index }}" class="ml-3 text-sm text-neutral-600">
                                    {{ categorie }} <span class="text-neutral-400">({{ random(5, 25) }})</span>
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                {# Prix #}
                <div>
                    <h3 class="text-sm font-medium text-stone-900 mb-3">Tranche de prix</h3>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="prix-min" class="block text-xs text-stone-500 mb-1">Min (€)</label>
                                <input type="number" 
                                       id="prix-min" 
                                       class="w-full rounded-md border-neutral-300 shadow-sm focus:border-amber-500/40 focus:ring-amber-500/40">
                            </div>
                            <div>
                                <label for="prix-max" class="block text-xs text-stone-500 mb-1">Max (€)</label>
                                <input type="number" 
                                       id="prix-max" 
                                       class="w-full rounded-md border-neutral-300 shadow-sm focus:border-amber-500/40 focus:ring-amber-500/40">
                            </div>
                        </div>
                        <button type="button" class="w-full bg-black text-white py-2 px-4 rounded-md hover:bg-neutral-900">Appliquer</button>
                    </div>
                </div>

                {# État #}
                <div>
                    <h3 class="text-sm font-medium text-stone-900 mb-3">État</h3>
                    <div class="space-y-2">
                        {% for etat in ['Neuf', 'Excellent', 'Bon', 'Satisfaisant'] %}
                            <div class="flex items-center">
                                <input id="etat-{{ loop.index }}" 
                                       name="etat[]" 
                                       type="checkbox" 
                                       value="{{ etat }}"
                                       class="h-4 w-4 rounded border-neutral-300 text-amber-600 focus:ring-amber-500/40">
                                <label for="etat-{{ loop.index }}" class="ml-3 text-sm text-neutral-600">
                                    {{ etat }}
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                {# Période #}
                <div>
                    <h3 class="text-sm font-medium text-stone-900 mb-3">Période</h3>
                    <div class="space-y-2">
                        {% for periode in ['Avant 1800', 'XIXe siècle', 'Années 1900-1950', 'Années 1950-2000'] %}
                            <div class="flex items-center">
                                <input id="periode-{{ loop.index }}" 
                                       name="periode[]" 
                                       type="checkbox" 
                                       value="{{ periode }}"
                                       class="h-4 w-4 rounded border-neutral-300 text-amber-600 focus:ring-amber-500/40">
                                <label for="periode-{{ loop.index }}" class="ml-3 text-sm text-neutral-600">
                                    {{ periode }}
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <button type="button" class="w-full mt-6 py-2 px-4 border border-stone-300 rounded-md text-stone-700 bg-white hover:bg-stone-50">
                    Réinitialiser les filtres
                </button>
            </div>
        </aside>

        {# Liste des lots #}
        <div class="lg:col-span-3">
            {# Barre de tri #}
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 bg-white p-4 rounded-lg border border-neutral-200">
                <p class="text-sm text-neutral-600 mb-2 sm:mb-0">
                    <span class="font-medium text-stone-900">{{ lots|length }}</span> résultats
                    {% if app.request.query.get('q') %}
pour "{{ app.request.query.get('q') }}"
                    {% endif %}
                </p>
                <div class="flex items-center">
                    <label for="tri" class="text-sm text-neutral-600 mr-2">Trier par :</label>
                    <select id="tri" 
                            class="rounded-md border-neutral-300 py-1 pl-2 pr-8 text-sm focus:border-amber-500/40 focus:outline-none focus:ring-1 focus:ring-amber-500/40">
                        <option>Pertinence</option>
                        <option {% if app.request.query.get('tri') == 'nouveaute' %}selected{% endif %}>Nouveautés</option>
                        <option {% if app.request.query.get('tri') == 'prix-croissant' %}selected{% endif %}>Prix croissant</option>
                        <option {% if app.request.query.get('tri') == 'prix-decroissant' %}selected{% endif %}>Prix décroissant</option>
                        <option {% if app.request.query.get('tri') == 'fin-proche' %}selected{% endif %}>Fin proche</option>
                    </select>
                </div>
            </div>

            {# Grille des lots #}
            {% if lots|length > 0 %}
                <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3">
                    {% for lot in lots %}
                        <article class="group bg-white rounded-xl border border-neutral-200 overflow-hidden hover:shadow-md transition-shadow">
                            <div class="relative">
                                <a href="{{ path('app_lot_show', {id: lot.id}) }}" class="block">
                                    <img src="{{ lot.imageFilename ? asset('uploads/' ~ lot.imageFilename) : asset('images/placeholder.jpg') }}"
                                         alt="" class="w-full h-48 object-cover rounded-lg" loading="lazy">
                                </a>
                                {% if lot.estVendu %}
                                    <div class="absolute top-3 right-3 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-full">
                                        Vendu
                                    </div>
                                {% elseif lot.dateFin is defined and lot.dateFin and date() < date(lot.dateFin) %}
                                    <div class="absolute bottom-3 left-3 right-3">
                                        <div class="bg-white/90 backdrop-blur-sm text-xs text-stone-800 font-medium px-2 py-1 rounded-full inline-flex items-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                            {{ date(lot.dateFin).diff(date())|date('%a j %Hh%M') }}
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="p-4">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1 min-w-0">
                                        <h3 class="font-medium text-stone-900 truncate">
                                            <a href="{{ path('app_lot_show', {id: lot.id}) }}" class="hover:text-amber-700">
                                                {{ lot.titre|default('Lot sans titre') }}
                                            </a>
                                        </h3>
                                        <p class="text-sm text-neutral-600 mt-1">{{ lot.categorie|default('Antiquité') }}</p>
                                    </div>
                                    <button type="button" class="ml-2 text-neutral-400 hover:text-amber-600" aria-label="Ajouter aux favoris">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <div class="mt-3 flex items-center justify-between">
                                    <div>
                                        <span class="text-xs text-neutral-600">Prix actuel</span>
                                        <p class="text-lg font-bold">
                                            {{ (lot.prixActuel|default(0))|number_format(2, ',', ' ') }} €
                                        </p>
                                    </div>
                                    <div class="text-right">
                                        <span class="text-xs text-neutral-500">Mise à jour</span>
                                        <p class="text-xs text-neutral-500">
                                            {{ 'now'|date_modify('-' ~ random(1, 24) ~ ' hours')|date('d/m H:i') }}
                                        </p>
                                    </div>
                                </div>

                                <a href="{{ path('app_lot_show', {id: lot.id}) }}"
                                   class="mt-4 inline-flex w-full justify-center px-4 py-2 text-sm rounded-lg bg-black text-white hover:bg-neutral-900 transition-colors">
                                    Voir le lot
                                </a>
                            </div>
                        </article>
                    {% endfor %}
                </div>

                {# Pagination #}
                <nav class="mt-10 flex items-center justify-between border-t border-neutral-200 px-4 sm:px-0">
                    <div class="-mt-px flex w-0 flex-1">
                        <a href="#" class="inline-flex items-center border-t-2 border-transparent pt-4 pr-1 text-sm font-medium text-neutral-600 hover:border-neutral-300 hover:text-black">
                            <svg class="mr-3 h-5 w-5 text-neutral-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M18 10a.75.75 0 01-.75.75H4.66l2.1 1.95a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 111.02 1.1l-2.1 1.95h12.59A.75.75 0 0118 10z" clip-rule="evenodd" />
                            </svg>
                            Précédent
                        </a>
                    </div>
                    <div class="hidden md:-mt-px md:flex">
                        <a href="#" class="inline-flex items-center border-t-2 border-black px-4 pt-4 text-sm font-medium text-black">1</a>
                        <a href="#" class="inline-flex items-center border-t-2 border-transparent px-4 pt-4 text-sm font-medium text-neutral-600 hover:border-neutral-300 hover:text-black">2</a>
                        <a href="#" class="inline-flex items-center border-t-2 border-transparent px-4 pt-4 text-sm font-medium text-neutral-600 hover:border-neutral-300 hover:text-black">3</a>
                        <span class="inline-flex items-center border-t-2 border-transparent px-4 pt-4 text-sm font-medium text-neutral-500">...</span>
                        <a href="#" class="inline-flex items-center border-t-2 border-transparent px-4 pt-4 text-sm font-medium text-neutral-600 hover:border-neutral-300 hover:text-black">8</a>
                    </div>
                    <div class="-mt-px flex w-0 flex-1 justify-end">
                        <a href="#" class="inline-flex items-center border-t-2 border-transparent pt-4 pl-1 text-sm font-medium text-neutral-600 hover:border-neutral-300 hover:text-black">
                            Suivant
                            <svg class="ml-3 h-5 w-5 text-neutral-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M2 10a.75.75 0 01.75-.75h12.59l-2.1-1.95a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.1-1.95H2.75A.75.75 0 012 10z" clip-rule="evenodd" />
                            </svg>
                        </a>
                    </div>
                </nav>
            {% else %}
                <div class="text-center py-16 bg-white rounded-xl border border-stone-200">
                    <svg class="mx-auto h-12 w-12 text-stone-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5m6 4.125l2.25 2.25m0 0l2.25 2.25M12 13.875l2.25-2.25M12 13.875l-2.25 2.25M3.375 7.5h17.25" />
                    </svg>
                    <h3 class="mt-2 text-lg font-medium text-stone-900">Aucun lot trouvé</h3>
                    <p class="mt-1 text-stone-500">Essayez de modifier vos critères de recherche ou de réinitialiser les filtres.</p>
                    <div class="mt-6">
                        <a href="{{ path('app_lot_index') }}" class="inline-flex items-center rounded-md bg-amber-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-amber-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-amber-600">
                            <svg class="-ml-0.5 mr-1.5 h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 01-9.201 2.466l-.312-.311h2.433a.75.75 0 000-1.5H3.989a.75.75 0 00-.75.75v4.242a.75.75 0 001.5 0v-2.43l.31.31a7 7 0 0011.712-3.138.75.75 0 00-1.449-.39 5.501 5.501 0 01-4.001 3.558z" clip-rule="evenodd" />
                                <path fill-rule="evenodd" d="M18.75 6.375a.75.75 0 00-.75.75v2.25H15a.75.75 0 000 1.5h3a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75z" clip-rule="evenodd" />
                                <path fill-rule="evenodd" d="M12.53 2.47a.75.75 0 00-1.06 0l-3 3a.75.75 0 001.06 1.06l1.72-1.72v8.19a.75.75 0 001.5 0v-8.19l1.72 1.72a.75.75 0 101.06-1.06l-3-3z" clip-rule="evenodd" />
                            </svg>
                            Réinitialiser les filtres
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

