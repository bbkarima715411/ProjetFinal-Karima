{# Prix actuel + incrément #}
<div class="mt-3">
  <p><strong>Prix actuel :</strong> {{ lot.prixActuel|number_format(2, ',', ' ') }} €</p>
  <p><small>Incrément minimum : {{ lot.incrementMin|number_format(2, ',', ' ') }} €</small></p>
</div>

{# Compte à rebours #}
{% if lot.evenementEnchere and lot.evenementEnchere.finAt %}
  <p><small>Fin dans : <span id="countdown" data-end="{{ lot.evenementEnchere.finAt|date('c') }}"></span></small></p>
{% endif %}

{# Formulaire d'enchère (POST) #}
{% if is_granted('IS_AUTHENTICATED_FULLY') %}
  {{ form_start(formOffre, { action: path('app_offre_sur_lot', {id: lot.id}), method: 'POST' }) }}
    {{ form_row(formOffre.montant) }}
    <button class="btn">Enchérir</button>
  {{ form_end(formOffre) }}
{% else %}
  <a class="btn" href="{{ path('app_login') }}">Connecte-toi pour enchérir</a>
{% endif %}

{% block javascripts %}
<script>
(function(){
  const el = document.getElementById('countdown');
  if(!el) return;
  const end = new Date(el.dataset.end).getTime();
  function tick(){
    const diff = Math.max(0, end - Date.now());
    const s = Math.floor(diff/1000);
    const h = String(Math.floor(s/3600)).padStart(2,'0');
    const m = String(Math.floor((s%3600)/60)).padStart(2,'0');
    const ss= String(s%60).padStart(2,'0');
    el.textContent = `${h}:${m}:${ss}`;
  }
  tick(); setInterval(tick, 1000);
})();
</script>
{% endblock %}
